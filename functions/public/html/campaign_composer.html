<!DOCTYPE html>
<html>
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

     <!-- Bootstrap CSS -->
     <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.0/themes/smoothness/jquery-ui.css">     
     <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
     <link rel="stylesheet" href="/vendor/colorPicker/css/bootstrap-colorpicker.css">
     <link rel='icon' href='https://vigil.com.ar/favicons/notimation.ico' type='image/x-icon' />
     
     <title>Noti Campaigns</title>    
    
      <style>  
    
       
     </style>

  </head>

  <body>    

    <script src="https://code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>    
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>        
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" defer></script>
    <script src="https://cdn.tiny.cloud/1/lr9wasio09vwo6la4k91gs8hybva1vp7oxw5k9cfpm2g5pm6/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.11.0/beautifier.js"></script>    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.11.0/beautifier.js"></script>

    <script src="https://www.gstatic.com/firebasejs/7.2.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.2.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.9.1/firebase-storage.js"></script>        
    <script src="https://www.gstatic.com/firebasejs/7.2.0/firebase-auth.js"></script>            
    <script src="https://www.gstatic.com/firebasejs/7.2.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.2.1/firebase-functions.js"></script>   

    <script src="https://kit.fontawesome.com/f014efefd7.js" crossorigin="anonymous"></script>

    <script src="/vendor/colorPicker/js/bootstrap-colorpicker.js"></script>

       
    
    <div class="container-fluid">
      <div class="row">
        <div class="col-md-12">
          <nav class="navbar navbar-expand-lg navbar-light bg-light navbar-dark bg-dark">
             
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
              <span class="navbar-toggler-icon"></span>
            </button> <a class="navbar-brand" href="#">Brand</a>
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
              <ul class="navbar-nav">
                <li class="nav-item active">
                   <a class="nav-link" href="#">Link <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                   <a class="nav-link" href="#">Link</a>
                </li>
                <li class="nav-item dropdown">
                   <a class="nav-link dropdown-toggle" href="http://example.com" id="navbarDropdownMenuLink" data-toggle="dropdown">Dropdown link</a>
                  <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                     <a class="dropdown-item" href="#">Action</a> <a class="dropdown-item" href="#">Another action</a> <a class="dropdown-item" href="#">Something else here</a>
                    <div class="dropdown-divider">
                    </div> <a class="dropdown-item" href="#">Separated link</a>
                  </div>
                </li>
              </ul>
              <form class="form-inline">
                <input class="form-control mr-sm-2" type="text" /> 
                <button class="btn btn-primary my-2 my-sm-0" type="submit">
                  Search
                </button>
              </form>
              <ul class="navbar-nav ml-md-auto">
                <li class="nav-item active">
                   <a class="nav-link" href="#">Link <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item dropdown">
                   <a class="nav-link dropdown-toggle" href="http://example.com" id="navbarDropdownMenuLink" data-toggle="dropdown">Dropdown link</a>
                  <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
                     <a class="dropdown-item" href="#">Action</a> <a class="dropdown-item" href="#">Another action</a> <a class="dropdown-item" href="#">Something else here</a>
                    <div class="dropdown-divider">
                    </div> <a class="dropdown-item" href="#">Separated link</a>
                  </div>
                </li>
              </ul>
            </div>
          </nav>

          <br>

          <div class="row">
            <div id="login">
              Not Logged
            </div>  
            <div class="col-md-4">
            </div>
            <div class="col-md-4">
              <h3 class="text-center">
                Noti Designer
              </h3>
            </div>
            <div class="col-md-4">
            </div>
          </div>

          <br>
          
          <div class="row">

            <div class="col-md-12">              

              <div class="row">                

                <!--NEW CAMPAIGN-->
                <div class="col-md-6">
                  <div class="row">
                    <div class="col-md-12">
                      <div class="row">
                        <div class="col-md-6">
                           <span class="badge badge-default float-right"><h5>Nombre campaña:</h5></span>
                        </div>
                        <div class="col-md-6">
                          <input type="text" class="form-control">
                          <p>Crea el cuerpo del mensaje</p>                                    
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-md-6">
                          <div class="row float-right">
                            <span class="badge badge-default"><h5>Agregar campo</h5></span>
                            <button type="button" class="btn btn-success ">
                              +
                            </button>
                          </div>
                        </div>
                        <div class="col-md-6">                           
                          
                          <label class="btn btn-default">
                            Subir archivo de Excel <input id="excel-file" type="file" hidden>
                            <i class="fas fa-file-excel"></i>
                          </label>
                        </div>
                      </div>
                      <br>
                      <div class="row">
                        <div class="col-md-12">

                          <table class="table table-bordered table-hover table-sm">
                            <thead>
                              <tr>
                                <th>                                  
                                </th>
                                <th>
                                  Campo
                                </th>
                                <th>
                                  Valor
                                </th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr>
                                <td>
                                  <span class="glyphicon glyphicon-envelope"></span>                                </td>
                                <td>
                                  <input type="text" class="form-control">
                                </td>
                                <td>
                                  <input type="text" class="form-control">
                                </td>                               
                              </tr>                              
                            </tbody>
                          </table>


                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-12">
                      <div class="row">
                        <div class="col-md-6">
                           
                          <button type="button" class="btn btn-success">
                            Borrar
                          </button>
                        </div>
                        <div class="col-md-6">
                           
                          <button type="button" class="btn btn-success">
                            Guardar Campaña
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                
                <!--TABLE-->
                <div class="col-md-6">
                  <table class="table table-bordered table-hover table-sm">
                    <thead>
                      <tr>
                        <th>
                          #
                        </th>
                        <th>
                          Product
                        </th>
                        <th>
                          Payment Taken
                        </th>
                        <th>
                          Status
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>
                          1
                        </td>
                        <td>
                          TB - Monthly
                        </td>
                        <td>
                          01/04/2012
                        </td>
                        <td>
                          Default
                        </td>
                      </tr>
                      <tr class="table-active">
                        <td>
                          1
                        </td>
                        <td>
                          TB - Monthly
                        </td>
                        <td>
                          01/04/2012
                        </td>
                        <td>
                          Approved
                        </td>
                      </tr>
                      <tr class="table-success">
                        <td>
                          2
                        </td>
                        <td>
                          TB - Monthly
                        </td>
                        <td>
                          02/04/2012
                        </td>
                        <td>
                          Declined
                        </td>
                      </tr>
                      <tr class="table-warning">
                        <td>
                          3
                        </td>
                        <td>
                          TB - Monthly
                        </td>
                        <td>
                          03/04/2012
                        </td>
                        <td>
                          Pending
                        </td>
                      </tr>
                      <tr class="table-danger">
                        <td>
                          4
                        </td>
                        <td>
                          TB - Monthly
                        </td>
                        <td>
                          04/04/2012
                        </td>
                        <td>
                          Call in to confirm
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <h3>
                Campañas
              </h3>
              <div class="row">
                <div class="col-md-4">
                  <div class="row">
                    <div class="col-md-12">
                      <div class="row">
                        <div class="col-md-8">
                        </div>
                        <div class="col-md-4">
                           
                          <button type="button" class="btn btn-success">
                            Cerrar
                          </button>
                        </div>
                      </div>
                      <h3>
                        h3. Lorem ipsum dolor sit amet.
                      </h3><img alt="Bootstrap Image Preview" src="https://www.layoutit.com/img/sports-q-c-140-140-3.jpg" />
                      <div class="row">
                        <div class="col-md-12">
                        </div>
                      </div><img alt="Bootstrap Image Preview" src="https://www.layoutit.com/img/sports-q-c-140-140-3.jpg" />
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                </div>
                <div class="col-md-4">
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
    //<![CDATA[


    /**
     * PDF TO HTML
     * 
     * https://www.idrsolutions.com/online-pdf-to-html5-converter
     * 
     * */

    /**
     * Drag and drop
     * http://jsfiddle.net/vacidesign/uskx816g/
     * */

    /**
     * jquery Uncaught SyntaxError: "Unexpected token '<'"
     * https://idiallo.com/javascript/uncaught-syntaxerror-unexpected-token#n
     * 
     * */

    /**
     * Stepper into modal
     * 
     * https://bbbootstrap.com/snippets/modal-dialog-multi-step-form-wizard-29726524
     * */

    $(document).ready(function () {  

      var active_saludo = false;
      var active_cuerpo = false;
      var active_from_button = false;

      var target_result;

      var data;
      var count_drop = 0;

      const firebaseConfig = {
        apiKey: "AIzaSyAM4WQDHpHh1oRT_v-6ikquE4V809hA3kY",
        authDomain: "notims.firebaseapp.com",
        databaseURL: "https://notims.firebaseio.com",
        projectId: "notims",
        storageBucket: "notims.appspot.com",
        messagingSenderId: "79471870593",
        appId: "1:79471870593:web:ef29a72e1b1866b2bb4380",
        measurementId: "G-8T5N81L78J"
      };
      firebase.initializeApp(firebaseConfig);

      const db = firebase.firestore();
      const storage = firebase.storage();
      const database = firebase.database();
      const functions = firebase.functions();

      var getUrlParameter = function getUrlParameter(sParam) {
          var sPageURL = window.location.search.substring(1),
              sURLVariables = sPageURL.split('&'),
              sParameterName,
              i;

          for (i = 0; i < sURLVariables.length; i++) {
              sParameterName = sURLVariables[i].split('=');

              if (sParameterName[0] === sParam) {
                  return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
              }
          }
      };           
    
      $( "#login" ).click(function() {       

        firebase.auth().signInWithEmailAndPassword("josemanuelvigil@gmail.com", "temporary").then(function(user) {                      
          window.location.reload();            
        }).catch( function(error) {                         
            var errorMessage = error.message;  
            console.log(errorMessage);
        });

      });
      
      $("#excel-file").on('change', function(){


        var input = document.getElementById("proImage");
            var j=0, k=0;
            var length = input.files.length;
            for (var i = 0; i < length; ++i) {            
                var _file = input.files.item(i);                                                  
                var filePathMuseum = title + "_" + i + "_original.png";        
                const museumRef = storageRef.child(filePathMuseum);
                const putRef = museumRef.put(_file, metadataFiles);  
                prefArray.push(putRef);  
                putRef.on('state_changed', function(snapshot) {
                    var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                    console.log('Upload is ' + progress + '% done');
                    switch (snapshot.state) {
                      case firebase.storage.TaskState.PAUSED: // or 'paused'
                        console.log('Upload is paused');
                        break;
                      case firebase.storage.TaskState.RUNNING: // or 'running'
                        console.log('Upload is running');
                        break;
                    }
                  }, function(error) {
                    // Handle unsuccessful uploads
                  }, function() {                                        
                    var putRefFromArray = prefArray[j];
                    putRefFromArray.snapshot.ref.getDownloadURL().then(function(downloadURL) {                      
                        db.collection("museums").doc(museumId).collection("images").add({downloadURL});
                        if (k==(length-1)){
                            $('#addMuseumModal').modal('hide');
                        }
                        k++;
                    });
                    j++;
                });   
            }

      });
    
      firebase.auth().onAuthStateChanged(function (user) {

        if (user) { 

          var documentId = getUrlParameter('id'); 

          db.collection("cobranzas").doc(documentId)
            .get()
            .then(function(doc) {

              var name =  doc.data().name;                
              var code =  doc.data().code;
              var contact =  doc.data().contact;                
              
              data = { 
                "nombre" :  { 
                  "datos" : name, 
                  "boton" : "btn-primary" 
                }, 
                "codigo" :  { 
                  "datos" : code, 
                  "boton" : "btn-secondary" 
                }, 
                "contacto" :  { 
                  "datos" : contact, 
                  "boton" : "btn-success" 
                }               
              };

              for (var key of Object.keys(data)) {
                
                let nombre = key;
                let datos = data[key]["datos"];
                let boton = data[key]["boton"];

                let _html = `&nbsp;&nbsp<button data-field="${datos}" style="color:white" class="botones btn ${boton}" type="button" id="${nombre}">${nombre}</button>&nbsp;&nbsp`;
           
                $("#composer").append(_html);

                $("#" + nombre).on('click', function (e) {                     
                  e.preventDefault();

                  active_from_button = true;

                  var timer_click = setTimeout(function() {                                                           
                  
                    var id = $(e.target).attr('id'); 
                    var variable;

                    if (id=="nombre") {
                      variable = "{nombre}";                     
                    } else if (id=="codigo") {
                      variable = "{codigo}";  
                    } else if (id=="contacto") {
                      variable = "{contacto}";
                    }

                    if (active_saludo) {

                      var cursorPos = $('#insaludo').prop('selectionStart');
                      var v = $('#insaludo').val();
                      var textBefore = v.substring(0,  cursorPos );
                      var textAfter  = v.substring( cursorPos, v.length );
                      $('#insaludo').val( textBefore + variable + textAfter ); 

                    } else if (active_cuerpo) {                                                      
                      tinymce.activeEditor.execCommand('mceInsertContent', false, variable);
                    }  

                    clearTimeout(timer_click);

                  }, 1000);

                });
              }
          });            
       
          $( ".draggable" ).draggable({
            appendTo: "body",
            helper: "clone"
          });
          
          $( ".droppable" ).droppable({
            accept: ".draggable",
            helper: "clone",
            hoverClass: "droppable-active",
            drop: function( event, ui ) {
              
              $(".empty-form").remove();
              var $orig = $(ui.draggable);
              
              if(!$(ui.draggable).hasClass("dropped")) {

                count_drop++;

                var name = $orig.find("label").attr("for");                      
                
                var $el = $orig
                  .clone()
                  .addClass("dropped")
                  .css({"position": "static", "left": null, "right": null})
                  .appendTo(this);

                if (name=="saludo") {                  
                  $el.find("p").remove();                                     
                }

                if (name=="cuerpo") {                  
                  $el.find("p").remove();                   
                  $el.find("input").replaceWith(`<textarea id="incuerpo"></textarea>`);                              
                  $el.find("textarea").removeAttr('placeholder');
                  initTinyEMC();
                }                

                /*if (name=="imagen") { 
                  $el.find("p").remove(); 
                  $el.find("input").attr('id', 'inimage');  
                  
                  $el.find("input").change(function() {                      
                      if (this.files && this.files[0]) {
                          var reader = new FileReader();            
                          reader.onload = function (e) {                              
                              target_result = e.target.result;
                              getHTML();
                          }            
                          reader.readAsDataURL(this.files[0]);
                      }
                  });
                }*/

                if (name=="contacto") {
                 $el.find("p").remove();           
                }

                if (name=="pagos") {
                  $el.find("p").remove();      
                  $('#pagos input[type="checkbox"]').click(function(){
                    getHTML();
                  });     
                }
               
                if (name=="color") {                              
                  $el.find("p").remove();
                  $el.find("input").attr('id', 'incolor');                 
                  $('#incolor').colorpicker();                        
                  $('#incolor').on('colorpickerChange', function(event) {
                    $('#preview').css('background-color', event.color.toString());
                  });
                }

                // update id
                var id = $orig.find(":input").attr("id");
                
                if(id) {
                  id = id.split("-").slice(0,-1).join("-") + "-" 
                    + (parseInt(id.split("-").slice(-1)[0]) + 1);                
                  $orig.find(":input").attr("id", id);
                  $orig.find("label").attr("for", id);
                }            

                // tools
                $('<p class="tools">\
                  <a class="text-primary edit-link">Visualizar<a> | \
                  <a class="text-primary remove-link">Remover</a></p>').appendTo($el);                             

                var timer = setTimeout(function() {                                        

                  $("#insaludo").focus(function(){
                    $(this).css("background-color", "#EFF0F1");
                    active_saludo = true;                      
                    active_cuerpo = false;
                    active_from_button = false;
                  });

                  $("#insaludo").blur(function(){
                    $(this).css("background-color", "white");
                    if (active_from_button) {
                      active_saludo = false;
                    }
                  });

                  $("#insaludo").change(function() {
                    getHTML();
                  });

                  clearTimeout(timer);

                }, 500);
               
              } else {
               
                if($(this)[0]!=$orig.parent()[0]) {
                
                  var $el = $orig
                    .clone()
                    .css({"position": "static", "left": null, "right": null})
                    .appendTo(this);
                  $orig.remove();

                }
              }
            }
          }).sortable();

          function getHTML() {

            var count = 0;
            var _html = "";

            $("#preview").empty(); 

            $('.draggable').each(function(index, value) { 


              try {
              
                console.log(`div${index}: ${this.id}`);              

                if (this.id == "saludo") {
                  count++;
                  let insaludo = $("#insaludo").val();
                  let saludo =  `<h3 style="margin-bottom: 50px;"><p class="font-weight-bold">
                                ${insaludo}</p></h3>`;
                  _html += saludo;
                } 
                
                if (this.id=="cuerpo") {                              
                  count++;
                  let inscuerpo = tinymce.activeEditor.getContent();
                  let cuerpo =  `<div style="margin-bottom: 40px;">
                              ${inscuerpo}</div>`;
                  _html += cuerpo;
                } 
                
                /*if (this.id=="imagen") {
                  count++;
                  if ($("#inimagen").val()!=undefined) {
                    let inimagen =  `<div style="width:100%; height:100%">
                                    <img style="margin-left: auto;  margin-right: auto; display: block; width: 50%;"
                                    src="${target_result}"></div>`;
                    _html += inimagen;
                  }
                }*/ 

                if (this.id=="pagos") {
                  count++;                
                  //let inMercado = $('#inMercado').prop('checked');
                  //let inRapi = $('#inRapi').prop('checked');
                  //let inFacil = $('#inFacil').prop('checked');
                  let inpagos = getPagos();
                  if (inpagos!=undefined) {
                      _html += inpagos;
                  }                
                } 

                if (count_drop == count) {               

                  let comupulsory = `
                  <footer class="footer">
                    <div class="container">
                      <hr>
                      <div class="row">
                        <div class="col-sm-2"/>                        
                        <div class="col-sm-8">
                          <button type="button" class="btn btn-primary col-12">Recibir notificaciones</button>
                        </div>
                        <div class="col-sm-2"/>
                      </div>     
                      <hr>              
                      <div class="row">
                        <div class="col-sm-2"/>                        
                        <div class="col-sm-8">
                          <button type="button" class="btn btn-secondary col-12">No soy esa persona</button>
                        </div>
                        <div class="col-sm-2"/>
                      </div>
                    </div>
                  </footer>`;

                  _html += comupulsory;

                  $("#preview").html(replaceVariables(_html));                 

                  return false;
               }


              } catch (e) {
                  console.error(e);
                  return e;
              }

            });
          };

          function getPagos() {

              var arrayObj = [
                {"image": "mercadopago.png", "id": "inMercado", "value": $('#inMercado').prop('checked')},
                {"image": "rapipago.png", "id": "inRapi", "value": $('#inRapi').prop('checked')},
                {"image": "pagofacil.png", "id": "inFacil", "value": $('#inFacil').prop('checked')},
                {"image": "otros.png", "id": "inOtros", "value": $('#inOtros').prop('checked')},
              ];

              var _array = arrayObj.filter(function(s) { 
                return s.value; 
              });

              count = _array.length;

              if (count==0) {
                return;
              }
              var inpagos = "";

              switch (count) {
                case 1:
                  inpagos = `<div class="row">
                      <div class="col">                         
                      </div>
                      <div class="col-5">
                        <img src="/images/${_array[0].image}"/>
                      </div>
                      <div class="col">                          
                      </div>
                    </div>`;
                  break;
                case 2:
                  inpagos = "";
                  break;
                case 3:
                  inpagos = "";
                  break;
              }

              return inpagos;

          }
        

          function replaceVariables(_html) {
            for (var key of Object.keys(data)) {                
              let nombre = "{" + key + "}";
              let datos = data[key]["datos"];
              _html = _html.replace(nombre, datos);             
            }
            return _html;
          }

          var get_modal = function(content) {
          var modal = $('<div class="modal" style="overflow: auto;" tabindex="-1">\
            <div class="modal-dialog">\
              <div class="modal-content">\
                <div class="modal-header">\
                  <a type="button" class="close"\
                    data-dismiss="modal" aria-hidden="true">&times;</a>\
                  <h4 class="modal-title">Edit HTML</h4>\
                </div>\
                <div class="modal-body ui-front">\
                  <textarea class="form-control" \
                    style="min-height: 200px; margin-bottom: 10px;\
                    font-family: Monaco, Fixed">'+content+'</textarea>\
                  <button class="btn btn-success">Update</button>\
                </div>\
              </div>\
            </div>\
            </div>').appendTo(document.body);
            
          return modal;
        };
        
        $(document).on("click", ".edit-link", function(ev) {   
          
          getHTML();
          
          /*var $el = $(this).parent().parent();
          var $el_copy = $el.clone();
          
          var $edit_btn = $el_copy.find(".edit-link").parent().remove();

          var $modal = get_modal(html_beautify($el_copy.html())).modal("show");
          $modal.find(":input:first").focus();
          $modal.find(".btn-success").click(function(ev2) {
            var html = $modal.find("textarea").val();
            if(!html) {
              $el.remove();
            } else {
              $el.html(html);
              $edit_btn.appendTo($el);
            }
            $modal.modal("hide");
            return false;
          });*/

        });
        
        $(document).on("click", ".remove-link", function(ev) {
          $(this).parent().parent().remove();
          count_drop--;
        });
        

          $("#login").text("Logged");

          function initTinyEMC() {  

            var camposFields = {
              one: "first",
              two: "second",
              three: "third"
            };         
            
            /**
             * SAMPLE
             * https://www.tiny.cloud/docs/demo/basic/
             * */

            tinymce.init({
              selector: 'textarea#incuerpo',
              menubar: false,
              height: 200,             
              plugins: [
                'advlist autolink lists link image charmap print preview anchor',
                'searchreplace visualblocks code fullscreen',
                'insertdatetime media table paste code wordcount'
              ],
              toolbar: 'undo redo | formatselect | ' +
              'bold italic backcolor | alignleft aligncenter ' +
              'alignright alignjustify | bullist numlist outdent indent | ' +
              'removeformat',
              content_css: '//www.tiny.cloud/css/codepen.min.css',

              setup: function(editor) {

                editor.on('change', function(ed) {              
                  let _content = editor.getContent();      
                  getHTML();  
                });
                
                /** Campos **/              
                editor.ui.registry.addMenuButton('campos', {
                  text: 'Campos',
                  fetch: function(callback) {
                    var items = [];
                    for (var fieldName in camposFields) {
                      var menuItem = {
                        type: 'menuitem',
                        text: camposFields[fieldName],
                        value:fieldName,
                        onSetup: function(buttonApi) {
                          var $this = this;
                          this.onAction = function() {
                            editor.insertContent($this.data.value);
                          };
                        },
                      };
                      items.push(menuItem);
                    }
                    callback(items);
                  },
                });
              }
            });

            tinymce.activeEditor.on('focus', function(e) {
              active_cuerpo = true;
              active_saludo = false;
              active_from_button = false;               
            });

            tinymce.activeEditor.on('blur', function(e) {                       
              if (active_from_button) {
                active_cuerpo = false;
              }                
            });

          }

        } else  {

        }

      });   

    });  

    /*  tinymce.init({
        language: 'es',
        selector: 'textarea',
        height: 500,
        theme: 'modern',
        plugins: 'print preview fullpage powerpaste searchreplace autolink directionality advcode visualblocks visualchars fullscreen image link template codesample table charmap hr pagebreak nonbreaking anchor toc insertdatetime advlist lists textcolor wordcount a11ychecker imagetools contextmenu colorpicker textpattern wordcount contextmenu help',
        toolbar1: 'formatselect | bold italic strikethrough forecolor backcolor | link | alignleft aligncenter alignright alignjustify  | numlist bullist outdent indent  | removeformat',
        contextmenu: "link image inserttable | cell row column deletetable",
        image_advtab: true,
        templates: [
          { title: 'Test template 1', content: 'Test 1' },
          { title: 'Test template 2', content: 'Test 2' }
        ],
        content_css: [
          '//fonts.googleapis.com/css?family=Lato:300,300i,400,400i',
          '//www.tinymce.com/css/codepen.min.css'
        ],
        setup:function(ed) {
          ed.on('change', function(e) {              
              $('#preview').html(ed.getContent());
          });
        },
        mobile: {
          menubar: true
        },

      });*/

      /**
       * 
       * Custom Menu Item
       * //https://www.tiny.cloud/docs/demo/custom-menu-item/
       * 
       * Local Upload
       * https://www.tiny.cloud/docs-4x/demo/local-upload/
       * 
       * Image Upload
       * https://www.tiny.cloud/docs-4x/general-configuration-guide/upload-images/
       * 
       * */
      
    
    //]]>
    </script>

   
   
  </body>
</html>
