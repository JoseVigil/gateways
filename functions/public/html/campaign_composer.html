<!DOCTYPE html>
<html>
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

     <!-- Bootstrap CSS -->
     <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.0/themes/smoothness/jquery-ui.css">     
     <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
     <link rel="stylesheet" href="/vendor/colorPicker/css/bootstrap-colorpicker.css">
     <link rel='icon' href='https://vigil.com.ar/favicons/notimation.ico' type='image/x-icon' />
     
     <title>Noti Campaigns</title>    
    
      <style>  
    
       
     </style>

  </head>

  <body>    

    <script src="https://code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>    
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>        
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" defer></script>
    <script src="https://cdn.tiny.cloud/1/lr9wasio09vwo6la4k91gs8hybva1vp7oxw5k9cfpm2g5pm6/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.11.0/beautifier.js"></script>    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.11.0/beautifier.js"></script>

    <script src="https://www.gstatic.com/firebasejs/7.2.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.2.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.9.1/firebase-storage.js"></script>        
    <script src="https://www.gstatic.com/firebasejs/7.2.0/firebase-auth.js"></script>            
    <script src="https://www.gstatic.com/firebasejs/7.2.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.2.1/firebase-functions.js"></script>   

    <script src="https://kit.fontawesome.com/f014efefd7.js" crossorigin="anonymous"></script>

    <script src="/vendor/colorPicker/js/bootstrap-colorpicker.js"></script>

       
    
    <div class="container-fluid">
      <div class="row">
        <div class="col-md-12">
          <nav class="navbar navbar-expand-lg navbar-light bg-light navbar-dark bg-dark">
             
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
              <span class="navbar-toggler-icon"></span>
            </button> <a class="navbar-brand" href="#">Brand</a>
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
              <ul class="navbar-nav">
                <li class="nav-item active">
                   <a class="nav-link" href="#">Link <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                   <a class="nav-link" href="#">Link</a>
                </li>
                <li class="nav-item dropdown">
                   <a class="nav-link dropdown-toggle" href="http://example.com" id="navbarDropdownMenuLink" data-toggle="dropdown">Dropdown link</a>
                  <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                     <a class="dropdown-item" href="#">Action</a> <a class="dropdown-item" href="#">Another action</a> <a class="dropdown-item" href="#">Something else here</a>
                    <div class="dropdown-divider">
                    </div> <a class="dropdown-item" href="#">Separated link</a>
                  </div>
                </li>
              </ul>
              <form class="form-inline">
                <input class="form-control mr-sm-2" type="text" /> 
                <button class="btn btn-primary my-2 my-sm-0" type="submit">
                  Search
                </button>
              </form>
              <ul class="navbar-nav ml-md-auto">
                <li class="nav-item active">
                   <a class="nav-link" href="#">Link <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item dropdown">
                   <a class="nav-link dropdown-toggle" href="http://example.com" id="navbarDropdownMenuLink" data-toggle="dropdown">Dropdown link</a>
                  <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
                     <a class="dropdown-item" href="#">Action</a> <a class="dropdown-item" href="#">Another action</a> <a class="dropdown-item" href="#">Something else here</a>
                    <div class="dropdown-divider">
                    </div> <a class="dropdown-item" href="#">Separated link</a>
                  </div>
                </li>
              </ul>
            </div>
          </nav>

          <br>

          <div class="row">
            <div id="login">
              Not Logged
            </div>  
            <div class="col-md-4">
            </div>
            <div class="col-md-4">
              <h3 class="text-center">
                Noti Designer
              </h3>
            </div>
            <div class="col-md-4">
            </div>
          </div>

          <br>
          
          <div class="row">

            <div class="col-md-12">              

              <div class="row">                

                <!--NEW CAMPAIGN-->
                <div class="col-md-6">
                  <div class="row">
                    <div class="col-md-12">
                      <div class="row">
                        <div class="col-md-6">
                           <span class="badge badge-default float-right"><h5>Nombre campaña:</h5></span>
                        </div>
                        <div class="col-md-6">
                          <input id="campaign-name" type="text" class="form-control">
                          <p>Crea el cuerpo del mensaje</p>                                    
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-md-6">
                          <div class="row float-right">
                            <span class="badge badge-default"><h5>Agregar campo</h5></span>
                            <button type="button" class="btn btn-success ">
                              +
                            </button>
                          </div>
                        </div>
                        <div class="col-md-6">                           
                          
                          <label class="btn btn-default">
                            Subir archivo de Excel <input id="excel-file" type="file" hidden>
                            <i class="fas fa-file-excel"></i>
                          </label>
                        </div>
                      </div>
                      <br>
                      <div class="row">
                        <div class="col-md-12">

                          <table class="table table-bordered table-hover table-sm">
                            <thead>
                              <tr>
                                <th>                                  
                                </th>
                                <th>
                                  Campo
                                </th>
                                <th>
                                  Valor
                                </th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr>
                                <td>
                                  <span class="glyphicon glyphicon-envelope"></span>                                </td>
                                <td>
                                  <input type="text" class="form-control">
                                </td>
                                <td>
                                  <input type="text" class="form-control">
                                </td>                               
                              </tr>                              
                            </tbody>
                          </table>


                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-12">
                      <div class="row">
                        <div class="col-md-6">
                           
                          <button type="button" class="btn btn-success">
                            Borrar
                          </button>
                        </div>
                        <div class="col-md-6">
                           
                          <button type="button" class="btn btn-success">
                            Guardar Campaña
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                
                <!--TABLE-->
                <div class="col-md-6">
                  <table class="table table-bordered table-hover table-sm">
                    <thead>
                      <tr>
                        <th>
                          #
                        </th>
                        <th>
                          Product
                        </th>
                        <th>
                          Payment Taken
                        </th>
                        <th>
                          Status
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>
                          1
                        </td>
                        <td>
                          TB - Monthly
                        </td>
                        <td>
                          01/04/2012
                        </td>
                        <td>
                          Default
                        </td>
                      </tr>
                      <tr class="table-active">
                        <td>
                          1
                        </td>
                        <td>
                          TB - Monthly
                        </td>
                        <td>
                          01/04/2012
                        </td>
                        <td>
                          Approved
                        </td>
                      </tr>
                      <tr class="table-success">
                        <td>
                          2
                        </td>
                        <td>
                          TB - Monthly
                        </td>
                        <td>
                          02/04/2012
                        </td>
                        <td>
                          Declined
                        </td>
                      </tr>
                      <tr class="table-warning">
                        <td>
                          3
                        </td>
                        <td>
                          TB - Monthly
                        </td>
                        <td>
                          03/04/2012
                        </td>
                        <td>
                          Pending
                        </td>
                      </tr>
                      <tr class="table-danger">
                        <td>
                          4
                        </td>
                        <td>
                          TB - Monthly
                        </td>
                        <td>
                          04/04/2012
                        </td>
                        <td>
                          Call in to confirm
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <h3>
                Campañas
              </h3>
              <div class="row">
                <div class="col-md-4">
                  <div class="row">
                    <div class="col-md-12">
                      <div class="row">
                        <div class="col-md-8">
                        </div>
                        <div class="col-md-4">
                           
                          <button type="button" class="btn btn-success">
                            Cerrar
                          </button>
                        </div>
                      </div>
                      <h3>
                        h3. Lorem ipsum dolor sit amet.
                      </h3><img alt="Bootstrap Image Preview" src="https://www.layoutit.com/img/sports-q-c-140-140-3.jpg" />
                      <div class="row">
                        <div class="col-md-12">
                        </div>
                      </div><img alt="Bootstrap Image Preview" src="https://www.layoutit.com/img/sports-q-c-140-140-3.jpg" />
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                </div>
                <div class="col-md-4">
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
    //<![CDATA[


    /**
     * PDF TO HTML
     * 
     * https://www.idrsolutions.com/online-pdf-to-html5-converter
     * 
     * */

    /**
     * Drag and drop
     * http://jsfiddle.net/vacidesign/uskx816g/
     * */

    /**
     * jquery Uncaught SyntaxError: "Unexpected token '<'"
     * https://idiallo.com/javascript/uncaught-syntaxerror-unexpected-token#n
     * 
     * */

    /**
     * Stepper into modal
     * 
     * https://bbbootstrap.com/snippets/modal-dialog-multi-step-form-wizard-29726524
     * */

    $(document).ready(function () {  

      var client = "sipef";

      var active_saludo = false;
      var active_cuerpo = false;
      var active_from_button = false;

      var target_result;

      var data;
      var count_drop = 0;

      const firebaseConfig = {
        apiKey: "AIzaSyAM4WQDHpHh1oRT_v-6ikquE4V809hA3kY",
        authDomain: "notims.firebaseapp.com",
        databaseURL: "https://notims.firebaseio.com",
        projectId: "notims",
        storageBucket: "notims.appspot.com",
        messagingSenderId: "79471870593",
        appId: "1:79471870593:web:ef29a72e1b1866b2bb4380",
        measurementId: "G-8T5N81L78J"
      };
      firebase.initializeApp(firebaseConfig);

      const db = firebase.firestore();
      const storage = firebase.storage();
      const database = firebase.database();
      const functions = firebase.functions();

      var getUrlParameter = function getUrlParameter(sParam) {
          var sPageURL = window.location.search.substring(1),
              sURLVariables = sPageURL.split('&'),
              sParameterName,
              i;

          for (i = 0; i < sURLVariables.length; i++) {
              sParameterName = sURLVariables[i].split('=');

              if (sParameterName[0] === sParam) {
                  return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
              }
          }
      };           
    
      $( "#login" ).click(function() {       

        firebase.auth().signInWithEmailAndPassword("josemanuelvigil@gmail.com", "temporary").then(function(user) {                      
          window.location.reload();            
        }).catch( function(error) {                         
            var errorMessage = error.message;  
            console.log(errorMessage);
        });

      });
      
      $("#excel-file").on('change', function(){


        let campaign_name = $("#campaign-name").val().split(' ').join('_');

        var _time =  new Date();   
        
        var path = `clients/${client}`; 

        db.collection(path).doc(campaign_name).set({
            name: campaign_name,
            last_update: _time,      
            time_created: _time 
          }).then(docRefSet => {      
            
            var id = docRefSet.id;
            
            var storageRef = storage.ref(path);       
              
            var filePath =  "jose.xls";        
            var thisRef = storageRef.child(filePath);    

            var file = document.getElementById("excel-file").files[0]; 
            var input = this;
            var length = input.files.length;
            var _file = input.files.item(0); 
            
            var metadataFiles = {
              customMetadata: {                
                  'type': 'xls',
                  'documentId' : id,
                  "path" : path                        
              }
            };

            var file = document.getElementById("excel-file").files[0];   
            var filePathMuseum = "jose.xlsx";        
            const museumRef = storageRef.child(filePathMuseum);
            var putRef = museumRef.put(_file, metadataFiles);          
            putRef.on('state_changed', function(snapshot) {
                var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                console.log('Upload is ' + progress + '% done');
                switch (snapshot.state) {
                  case firebase.storage.TaskState.PAUSED: // or 'paused'
                    console.log('Upload is paused');
                    break;
                  case firebase.storage.TaskState.RUNNING: // or 'running'
                    console.log('Upload is running');
                    break;
                }
              }, function(error) {
                // Handle unsuccessful uploads
              }, function() {                                        

                putRef.ref.getDownloadURL().then(function(downloadURL) {                      
                    db.collection("museums").doc(museumId).collection("images").add({downloadURL});
                    if (k==(length-1)){
                        $('#addMuseumModal').modal('hide');
                    }
                    k++;
                });
                j++;
            });
            
          }).catch((error) => {     
            console.error("Error adding document: ", error);           
          });   
        });  


           
            

      });
    
      firebase.auth().onAuthStateChanged(function (user) {

        if (user) { 

          var documentId = getUrlParameter('id'); 

        }

      });  

    });  
    </script>

   
   
  </body>
</html>
